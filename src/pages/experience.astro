---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

// Get experience data from content collection
const experiences = await getCollection("experience");
// Sort by start date (most recent first)
experiences.sort(
  (a, b) =>
    new Date(b.data.startDate).getTime() - new Date(a.data.startDate).getTime(),
);
---

<Layout
  title="Experience - Amir"
  description="My professional experience and career journey in software engineering."
>
  <div class="py-8">
    <div class="max-w-2xl mx-auto">
      <h1
        class="text-2xl md:text-4xl font-bold mb-4 font-serif text-gray-900 dark:text-white"
      >
        Experience
      </h1>
      <p class="text-base mb-8 text-gray-600 dark:text-gray-400">
        My journey in software engineering, from learning the fundamentals to
        building production systems.
      </p>

      {
        experiences.length > 0 ? (
          <div class="space-y-8">
            {experiences.map((experience) => (
              <div class="border-l-2 border-red-400 pl-6 relative">
                <div class="absolute -left-2 top-0 w-4 h-4 bg-red-400 rounded-full" />

                <div class="mb-3">
                  <div class="flex justify-between items-start mb-2">
                    <h2 class="text-lg font-bold text-gray-900 dark:text-white">
                      {experience.data.position}
                    </h2>
                    <span class="text-sm text-gray-500">
                      {new Date(experience.data.startDate).toLocaleDateString(
                        "en-US",
                        { month: "short", year: "numeric" },
                      )}{" "}
                      -{" "}
                      {experience.data.endDate
                        ? new Date(experience.data.endDate).toLocaleDateString(
                            "en-US",
                            { month: "short", year: "numeric" },
                          )
                        : "Present"}
                    </span>
                  </div>
                  <h3 class="text-base text-red-400 mb-2">
                    {experience.data.company}
                  </h3>
                  {experience.data.current && (
                    <span class="inline-block bg-green-500 text-white px-2 py-1 rounded text-xs">
                      Current
                    </span>
                  )}
                </div>

                <p class="text-sm mb-4 leading-relaxed text-gray-600 dark:text-gray-400">
                  {experience.data.description}
                </p>

                {experience.data.technologies &&
                  experience.data.technologies.length > 0 && (
                    <div class="flex flex-wrap gap-2">
                      {experience.data.technologies.map((tech) => (
                        <span class="text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400">
                          {tech}
                        </span>
                      ))}
                    </div>
                  )}
              </div>
            ))}
          </div>
        ) : (
          <div class="text-center py-16">
            <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">
              Experience Coming Soon
            </h2>
            <p class="text-gray-400 mb-6">
              I'm currently updating my experience section. Check back soon to
              see my professional journey.
            </p>
            <p class="text-sm text-gray-500">
              In the meantime, feel free to check out my{" "}
              <a href="/projects" class="text-blue-400 hover:text-blue-300">
                projects
              </a>{" "}
              or{" "}
              <a href="/about" class="text-blue-400 hover:text-blue-300">
                about page
              </a>
              .
            </p>
          </div>
        )
      }
    </div>
  </div>
</Layout>
